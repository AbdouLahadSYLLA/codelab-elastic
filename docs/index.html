
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Codelab Elastic</title>
  <script src="../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <link rel="import" href="../../elements/codelab.html">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <style is="custom-style">
    body {
      font-family: "Roboto",sans-serif;
      background: var(--google-codelab-background, #F8F9FA);
    }
  </style>
  
</head>
<body unresolved class="fullbleed">

  <google-codelab title="Codelab Elastic"
                  environment="web"
                  feedback-link="">
    
      <google-codelab-step label="Start Elasticsearch / Kibana / Filebeat and the monitored application" duration="0">
        <p>Our application is based on a Front application using Angular and a NodeJS REST API.</p>
<ul>
<li>In order to launch the demo app, you should run the following command</li>
</ul>
<pre><code>git clone https://github.com/Gillespie59/devoxx-universite-elastic -b nightclazz
cd devoxx-universite-elastic/step0
docker-compose up
</code></pre>
<ul>
<li>Open your browser at http://localhost to check if the application is available</li>
<li>You can also access to the REST API. Here are the differents URLs we have.<ul>
<li>GET http://localhost:8080/rest/products</li>
<li>GET http://localhost:8080/rest/fake/url returning 404</li>
<li>GET http://localhost:8080/rest/long/task returning 200 after 5s</li>
<li>GET http://localhost:8080/rest/weather calling an external service</li>
</ul>
</li>
<li>In the previous docker-compose file, we also defined everything needed to start our logs management system.<ul>
<li>Have a look to the response of GET http://localhost:9200 to check if the Elasticsearch cluster is UP</li>
<li>Go to http://localhost:5601 to check if the Kibana UI is available.</li>
</ul>
</li>
</ul>
<p>We will now enable Filebeat and index and visualize the logs generated by NGINX.</p>
<ul>
<li>Download Filebeat</li>
</ul>
<pre><code>curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.2.3-darwin-x86_64.tar.gz
tar xzvf filebeat-6.2.3-darwin-x86_64.tar.gz
</code></pre>
<ul>
<li>In order to start you should executed the following commands :</li>
</ul>
<pre><code>sudo bin/filebeat -e -c config/filebeat/filebeat.yml
</code></pre>
<ul>
<li>You should see new Kibana dashboards available. If you emulate visitors on your application, you should see hits in the Kibana UI.<br><br><ul>
<li>For emulating visitors, you can manually refresh the web page of the monitored application</li>
<li>or use the <code>ab</code> tool : <code>ab -n 100000 -c 1 http://127.0.0.1:80/index.html</code></li>
</ul>
</li>
</ul>
<p>Our two speakers will explains the configuration of this step 0</p>
<h2>Next step</h2>
<p>Look at <a href="https://github.com/Gillespie59/devoxx-universite-elastic/tree/master/step1" target="_blank">step1-setup-elaticsearch-kibana</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="Add Packetbeat" duration="0">
        <p>We will now add Packetbeat to our plateform.</p>
<ul>
<li>Download Packetbeat</li>
</ul>
<pre><code>curl -L -O https://artifacts.elastic.co/downloads/beats/packetbeat/packetbeat-6.2.3-darwin-x86_64.tar.gz
tar xzvf packetbeat-6.2.3-darwin-x86_64.tar.gz
</code></pre>
<ul>
<li>Create the <code>config/packetbeat/packetbeat.yml</code> configuration file based on this default configuration file : https://github.com/elastic/beats/blob/master/packetbeat/packetbeat.yml</li>
<li>Change the default configuration file ;<ul>
<li>in order to listen only the 80, 8080 and 9200 ports</li>
<li>packetbeat should automatically create Kibana dashboards</li>
<li>Packetbeat should send the data directly to Elasticsearch</li>
</ul>
</li>
<li>You can noz execute Packetbeat and start indexing network data.</li>
</ul>
<pre><code>sudo chown root config/packetbeat/packetbeat.yml
sudo bin/packetbeat -e -c config/packetbeat/packetbeat.yml
</code></pre>
<ul>
<li>You can now have a look to the HTTP dashboard automatically created by Packetbeat</li>
</ul>
<h2>Next step</h2>
<p>Look at <a href="https://github.com/Gillespie59/devoxx-universite-elastic/tree/master/step2" target="_blank">step 2 Metric Beat</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="Monitor our Docker images" duration="0">
        <p>We will add now the last beat of the day : Metricbeat for Docker containers</p>
<ul>
<li>Download Metricbeat</li>
</ul>
<pre><code>curl -L -O https://artifacts.elastic.co/downloads/beats/metricbeat/metricbeat-6.2.3-darwin-x86_64.tar.gz
tar xzvf metricbeat-6.2.3-darwin-x86_64.tar.gz
</code></pre>
<ul>
<li>Create the <code>config/metricbeat/metricbeat.yml</code> configuration file based on this default configuration file : https://github.com/elastic/beats/blob/master/metricbeat/metricbeat.yml</li>
<li>Change the default configuration file ;<ul>
<li>We will monitor only informations about our Docker images</li>
</ul>
</li>
</ul>
<pre><code>metricbeat.modules:
- module: docker
  metricsets: [&#34;container&#34;, &#34;cpu&#34;, &#34;diskio&#34;, &#34;healthcheck&#34;, &#34;info&#34;, &#34;memory&#34;, &#34;network&#34;]
  hosts: [&#34;unix:///var/run/docker.sock&#34;]
  period: 10s
</code></pre>
<ul>
<li>Metricbeat should automatically create Kibana dashboards</li>
<li>Metricbeat should send the data directly to Elasticsearch</li>
</ul>
<p>In order to start Metricbeat, you should execut the following commands :</p>
<pre><code>sudo chown root config/metricbeat/metricbeat.yml
sudo bin/metricbeat -e -c config/metricbeat/metricbeat.yml
</code></pre>
<ul>
<li>Open Kibana and you should have access again to new dashboards</li>
</ul>
<h2>Next step</h2>
<p>Look at <a href="https://github.com/Gillespie59/devoxx-universite-elastic/tree/master/step3" target="_blank">step3 APM</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="APM" duration="0">
        <p>And what if we monitor our NodeJS server now? We will use the APM features of the Elastic stack</p>
<ul>
<li>Start docker-compose without the back</li>
<li>Start the back with nodemon in order to have the hot reload feature.</li>
</ul>
<pre><code>nodemon run start
</code></pre>
<ul>
<li>Go the the home page of kibana in order to see how we can enable APM</li>
<li>In order to configure APM, create a file <code>config/apm/apm-server.yml</code></li>
<li>Based on this default configuration file (https://github.com/elastic/apm-server/blob/master/apm-server.yml), make the necessary changes<br><br><ul>
<li>APM should send information to Elasticsearch</li>
<li>APM should automatically create Kibana dashboards</li>
</ul>
</li>
<li>Launch the APM server</li>
</ul>
<pre><code>bin/apm-server -e -c config/apm/apm-server.yml
</code></pre>
<ul>
<li>Open Kibana and check the available dashboards</li>
<li>Install the NPM dependency into the NodeJS API REST server.</li>
<li>Add the setup code in the Express server</li>
<li>Show the result in Kibana</li>
<li>Add nested call to the weather endpoint in order to see multiple spans in a transaction</li>
<li>Add a custom span with just a simple sleep</li>
</ul>
<h2>Next step</h2>
<p>Look at <a href="https://github.com/Gillespie59/devoxx-universite-elastic/tree/master/step4" target="_blank">step4 Security</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="APM" duration="0">
        <p>And what if we monitor our NodeJS server now? We will use the APM features of the Elastic stack</p>
<ul>
<li>Start docker-compose without the back</li>
<li>Start the back with nodemon in order to have the hot reload feature.</li>
</ul>
<pre><code>nodemon run start
</code></pre>
<ul>
<li>Go the the home page of kibana in order to see how we can enable APM</li>
<li>In order to configure APM, create a file <code>config/apm/apm-server.yml</code></li>
<li>Based on this default configuration file (https://github.com/elastic/apm-server/blob/master/apm-server.yml), make the necessary changes<br><br><ul>
<li>APM should send information to Elasticsearch</li>
<li>APM should automatically create Kibana dashboards</li>
</ul>
</li>
<li>Launch the APM server</li>
</ul>
<pre><code>bin/apm-server -e -c config/apm/apm-server.yml
</code></pre>
<ul>
<li>Open Kibana and check the available dashboards</li>
<li>Install the NPM dependency into the NodeJS API REST server.</li>
<li>Add the setup code in the Express server</li>
<li>Show the result in Kibana</li>
<li>Add nested call to the weather endpoint in order to see multiple spans in a transaction</li>
<li>Add a custom span with just a simple sleep</li>
</ul>
<h2>Next step</h2>
<p>Look at <a href="https://github.com/Gillespie59/devoxx-universite-elastic/tree/master/step4" target="_blank">step4 Security</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="Alerting" duration="0">
        <p>We will now add alerts in our plateform. We will send alerts if we have less than 10 requests in the last 5 mn .</p>
<ul>
<li>Add username/password to the filebeat configuration file</li>
</ul>
<pre><code>setup.kibana:
  host: &#34;localhost:5601&#34;
  username: &#34;elastic&#34;
  password: &#34;changeme&#34;
</code></pre>
<ul>
<li>In the admin part of Kibana, add a watcher. For the demo, we will only send a log message to the console<ul>
<li>We won&#39;t create the Watcher thanks to an HTTP request. We will use the dedicated Kibana UI (threshold watch)</li>
<li>Name this watcher <code>nightclazz</code></li>
<li>This watcher should use index pattern <code>filebeat-*</code>.</li>
<li>If we have less than 10 requests in the last 5mn, we should logs this message : Votre site n&#39;a pas beaucoup de visiteurs (XXX), with XXX the number of visits</li>
</ul>
</li>
<li>Have a look the History page of a watcher.</li>
<li>From the Devtools, execute the following request</li>
</ul>
<pre><code>GET _xpack/watcher/watch/&lt;ID of the watcher&gt;

GET .watcher-history*/_search?pretty
{
  &#34;query&#34;: {
            &#34;match&#34;: {
              &#34;metadata.name&#34;: &#34;nightclazz&#34;
            }
          }

}
</code></pre>
<ul>
<li>Create a quick Counter in order to show the number of alerts.</li>
</ul>


      </google-codelab-step>
    
  </google-codelab>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-49880327-14', 'auto');

    (function() {
      var gaCodelab = '';
      if (gaCodelab) {
        ga('create', gaCodelab, 'auto', {name: 'codelab'});
      }

      var gaView;
      var parts = location.search.substring(1).split('&');
      for (var i = 0; i < parts.length; i++) {
        var param = parts[i].split('=');
        if (param[0] === 'viewga') {
          gaView = param[1];
          break;
        }
      }
      if (gaView && gaView !== gaCodelab) {
        ga('create', gaView, 'auto', {name: 'view'});
      }
    })();
  </script>

</body>
</html>
